<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Album Merch Reviews</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #B3CCE5;
    }
    .star {
      font-size: 1.2rem;
      color: #ccc;
      cursor: pointer;
    }
    .star.active {
      color: #ffc107;
    }
    
  </style>
</head>
<body>

  <div class="container py-5">
    <div class="card shadow-lg">
      <div class="card-body">
        
        <!-- Summary -->
        <div class="mb-4" id="rating-summary">
          <h3 class="fw-bold">0.0</h3>
          <p class="text-muted small">Based on 0 Reviews</p>
          <div id="summary-stars"></div>
        </div>

        <!-- Breakdown -->
        <div id="rating-breakdown" class="mb-4"></div>

        <!-- Add Review Button -->
        <button class="btn btn-primary mb-4" data-bs-toggle="collapse" data-bs-target="#addReviewForm">
          + Add Review
        </button>

        <!-- Add Review Form -->
        <div class="collapse mb-4" id="addReviewForm">
          <div class="card card-body">
            <h5 class="mb-3">Masukkan Review</h5>
            <div class="mb-3">
              <label class="form-label">Nama</label>
              <input type="text" id="reviewName" class="form-control" placeholder="Nama Anda">
            </div>
            <div class="mb-3">
              <label class="form-label">Rating</label>
              <div id="ratingStars"></div>
            </div>
            <div class="mb-3">
              <label class="form-label">Komentar</label>
              <textarea id="reviewComment" rows="3" class="form-control" placeholder="Beritahu kami kesan anda"></textarea>
            </div>
            <button class="btn btn-success" onclick="addReview()">Kirim Review</button>
          </div>
        </div>

        <!-- Reviews List -->
        <h5 class="mb-3">Semua Reviews</h5>
        <div id="reviewsList"></div>

      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let reviews = [
      { id: 1, user: "Tasya", date: "12 Mar 2024", rating: 5, comment: "Official and authentic, packaging very safe and got freebies!" },
      { id: 2, user: "Rina", date: "10 Mar 2024", rating: 4, comment: "Good quality but shipping took a while." }
    ];
    let currentRating = 5;

    function renderStars(rating, containerId, interactive=false) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      for (let i = 1; i <= 5; i++) {
        const star = document.createElement("span");
        star.innerHTML = "★";
        star.classList.add("star");
        if (i <= rating) star.classList.add("active");
        if (interactive) {
          star.onclick = () => {
            currentRating = i;
            renderStars(currentRating, containerId, true);
          };
        }
        container.appendChild(star);
      }
    }

    function calculateStats() {
      const total = reviews.length;
      if (total === 0) return {average: 0, total: 0, percentages: {1:0,2:0,3:0,4:0,5:0}};
      let sum = reviews.reduce((acc,r) => acc + r.rating, 0);
      let average = (sum / total).toFixed(1);
      let counts = {1:0,2:0,3:0,4:0,5:0};
      reviews.forEach(r => counts[r.rating]++);
      let percentages = {};
      for (let i=1; i<=5; i++) {
        percentages[i] = Math.round((counts[i]/total)*100);
      }
      return {average, total, percentages};
    }

    function renderSummary() {
      const stats = calculateStats();
      document.querySelector("#rating-summary h3").innerText = stats.average;
      document.querySelector("#rating-summary p").innerText = `Based on ${stats.total} Reviews`;
      renderStars(Math.round(stats.average), "summary-stars");
      
      // Breakdown
      let breakdown = document.getElementById("rating-breakdown");
      breakdown.innerHTML = "";
      for (let i=5; i>=1; i--) {
        breakdown.innerHTML += `
          <div class="d-flex align-items-center mb-1">
            <span>${"★".repeat(i)}</span>
            <div class="progress flex-grow-1 mx-2" style="height:8px;">
              <div class="progress-bar bg-warning" role="progressbar" style="width: ${stats.percentages[i]}%"></div>
            </div>
            <small>${stats.percentages[i]}%</small>
          </div>
        `;
      }
    }

    function renderReviews() {
      const list = document.getElementById("reviewsList");
      list.innerHTML = "";
      reviews.forEach(r => {
        list.innerHTML += `
          <div class="card mb-2">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div><strong>${r.user}</strong> ${"★".repeat(r.rating)}</div>
                <small class="text-muted">${r.date}</small>
              </div>
              <p class="mb-0">${r.comment}</p>
            </div>
          </div>
        `;
      });
    }

    function addReview() {
      const name = document.getElementById("reviewName").value.trim();
      const comment = document.getElementById("reviewComment").value.trim();
      if (!name || !comment) return alert("Please fill all fields");

      const today = new Date().toLocaleDateString("en-GB", {day:"2-digit", month:"short", year:"numeric"});
      reviews.unshift({id: Date.now(), user: name, date: today, rating: currentRating, comment});
      document.getElementById("reviewName").value = "";
      document.getElementById("reviewComment").value = "";
      currentRating = 5;
      renderStars(currentRating, "ratingStars", true);
      renderSummary();
      renderReviews();
    }

    // Initial render
    renderStars(currentRating, "ratingStars", true);
    renderSummary();
    renderReviews();
  </script>
</body>
</html>
